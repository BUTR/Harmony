on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

env:
  # Disable the .NET logo in the console output.
  DOTNET_NOLOGO: true
  # Disable the .NET first time experience to skip caching NuGet packages and speed up the build.
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
  # Disable sending .NET CLI telemetry to Microsoft.
  DOTNET_CLI_TELEMETRY_OPTOUT: true

jobs:
  windows-dotnet:
    strategy:
      matrix:
        architecture: ['x86', 'x64']
        target_framework: ['netcoreapp3.0', 'netcoreapp3.1', 'net5.0', 'net6.0', 'net7.0', 'net8.0']
        build_configuration: ['ReleaseFat', 'ReleaseThin']
    uses: ./.github/workflows/windows-dotnet.yml
    with:
      architecture: ${{ matrix.architecture }}
      target_framework: ${{ matrix.target_framework }}
      build_configuration: ${{ matrix.build_configuration }}

  windows-framework:
    strategy:
      matrix:
        architecture: ['x86', 'x64']
        target_framework: ['net35', 'net452', 'net472', 'net48']
        build_configuration: ['ReleaseFat', 'ReleaseThin']
    uses: ./.github/workflows/windows-framework.yml
    with:
      architecture: ${{ matrix.architecture }}
      target_framework: ${{ matrix.target_framework }}
      build_configuration: ${{ matrix.build_configuration }}

  windows-mono:
    strategy:
      matrix:
        architecture: ['x86', 'x64']
        target_framework: ['net35', 'net452', 'net472', 'net48']
        build_configuration: ['ReleaseFat', 'ReleaseThin']
    uses: ./.github/workflows/windows-mono.yml
    with:
      architecture: ${{ matrix.architecture }}
      target_framework: ${{ matrix.target_framework }}
      build_configuration: ${{ matrix.build_configuration }}

  ubuntu-macos-x64-dotnet:
    strategy:
      matrix:
        image: ['ubuntu-latest', 'macos-13']
        architecture: ['x64']
        target_framework: ['netcoreapp3.0', 'netcoreapp3.1', 'net5.0', 'net6.0', 'net7.0', 'net8.0']
        build_configuration: ['ReleaseFat', 'ReleaseThin']
    uses: ./.github/workflows/unix-dotnet.yml
    with:
      image: ${{ matrix.image }}
      architecture: ${{ matrix.architecture }}
      target_framework: ${{ matrix.target_framework }}
      build_configuration: ${{ matrix.build_configuration }}

  ubuntu-macos-x64-mono:
    strategy:
      matrix:
        image: ['ubuntu-latest', 'macos-13']
        architecture: ['x64']
        target_framework: ['net35', 'net452', 'net472', 'net48']
        build_configuration: ['ReleaseFat', 'ReleaseThin']
    uses: ./.github/workflows/unix-mono.yml
    with:
      image: ${{ matrix.image }}
      architecture: ${{ matrix.architecture }}
      target_framework: ${{ matrix.target_framework }}
      build_configuration: ${{ matrix.build_configuration }}
      
  macos-arm64-dotnet:
    strategy:
      matrix:
        image: ['macos-14']
        architecture: ['arm64']
        target_framework: ['net6.0', 'net7.0', 'net8.0']
        build_configuration: ['ReleaseFat', 'ReleaseThin']
    uses: ./.github/workflows/unix-dotnet.yml
    if: false
    with:
      image: ${{ matrix.image }}
      architecture: ${{ matrix.architecture }}
      target_framework: ${{ matrix.target_framework }}
      build_configuration: ${{ matrix.build_configuration }}
